---
title: 一貫性と可用性のパターン
description: 一貫性と可用性のパターンについてまとめます
summary: ソフトウェア設計を行う際に考慮するべき一貫性と可用性についてのパターンをまとめました。
slug: consistency-and-availabiilty-pattern
tags:
  - ソフトウェア設計
  - Tech
date: "2026-02-04"
---

一貫性と可用性のパターンについて調べました。

## 一貫性のパターンについて
https://cs.fyi/guide/consistency-patterns-week-strong-eventual

強い整合性、弱い整合性、結果整合性の 3 パターンがあります。  
一貫性ではなく整合性と呼ぶ方が多い気がしますね。

この 3 つについては元々知っていたのですが、改めて復習になりました。

### 強い整合性
強い整合性を持つシステムでは、データの変更は即時に反映され、その後続くすべての読み取り処理では変更された新しいデータが取得されます。

強い整合性を保つ分、可用性は落ち、レイテンシは高まってしまいます（すべてを更新できない場合は失敗させる必要があるのと、変更をすべてのノードに伝播させる必要があるため）。

そのため金融などのシステムに使われます。

### 弱い整合性
弱い整合性を持つシステムでは、データの変更が即時に反映されるとは限らず、読み取りタイミングによって反映されていたりされていなかったりします。そもそも整合が取られないケースも OK です。

弱い整合性で良いので、可用性は高まり、レイテンシは低いです（すべての更新反映を待たずに処理を完了させられるため）

オンラインゲームなどのリアルタイム処理を必要とするものの厳密な整合性が不要なシステムなどで利用されます。

### 結果整合性
結果整合性は弱い整合性の一種ですが、こちらは最終的には整合をとります。

例えば、更新後にそのサーバーに問い合わせた場合は即座に新しい値が読み取れるが、別のサーバーに問い合わせた場合は古い値が読み取られるものの、数分経てばどのサーバーでも同じ値が読み取られます。

## 可用性のパターンについて
可用性を確保するためのパターンをまとめます。

### Fail-Over 
Fail を Over するイメージで、プライマリーコンポーネントがダウンするとセカンダリーに移ります。

Fail-Over にもパターンがあるので注意です。

1. Active-Active フェイルオーバー: 最初から 2 台ともリクエストを受け付けます。
2. Active-Passive フェイルオーバー: プライマリーがダウンしたらセカンダリーにトラフィックを流します。セカンダリが最初から起動している（ホットスタンバイ）かダウンしてから起動するか（コールドスタンバイ）でダウンタイムが代わります。

Fail-Over は追加のインフラリソースがかかるのと、切り替え処理中にデータが消失するリスクに注意です。

### Replication Pattern
レプリケーションパターンはデータにまつわる可用性パターンです。  

#### 1. Master-Master レプリケーション

2 台とも書き込みと読み込みで使用させるパターンです。  
片方がダウンしても処理を継続できます。

いくつか注意点があります。

- 弱い整合性にするか、または強い整合性を確保してレイテンシを向上させる必要があります。
- 強い整合性を持たない場合は、2台それぞれに同時に書き込みがあった場合の考慮が必要です。

2. Master-Slave レプリケーション
Master のデータベースは書き込みと読み込みを担当し、Slave のデータベースは読み込みのみを担当します。そして Master がダウンしたら Slave を昇格させ、書き込みも可能にします。

いくつか注意点があります。

- 整合性について。弱い整合性にするか、または強い整合性を確保してレイテンシを向上させる必要があります。
- Slave を昇格させる手順と時間が必要です。

## 終わりに
一貫性も可用性も、トレードオフなのがわかります。
